## 熟悉事务隔离



### read uncommitted

read uncommitted 是隔离级别最低的档次。

```
查看事务隔离级别
show variables like 'transaction_isolation';

设置
set global transaction isolation level read UNCOMMITTED

```

设置完了一定要重新打开新命令行才行，不然也还是之前的隔离级别。

创建一个数据库并建立一张表，引擎一定要是MyISAM，默认的InnoDB是没有事务的。
```
-- ----------------------------
-- Table structure for aaa
-- ----------------------------
DROP TABLE IF EXISTS `aaa`;
CREATE TABLE `aaa` (
  `id` int NOT NULL AUTO_INCREMENT,
  `price` int DEFAULT '0',
  `name` varchar(10) COLLATE utf8mb4_general_ci DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- ----------------------------
-- Records of aaa
-- ----------------------------
BEGIN;
INSERT INTO `aaa` VALUES (1, 55, 'test');
COMMIT;

```


#### 脏读
脏读指的是读到了其他事务未提交的数据，未提交意味着这些数据可能会回滚，也就是可能最终不会存到数据库中，也就是不存在的数据。读到了并不一定最终存在的数据，这就是脏读。

```
设置事务级别为读未提交
set global transaction isolation level read UNCOMMITTED
```

开启二个命令行，按如下步骤进行测试。

#### 命令行一
```
mysql> begin;
Query OK, 0 rows affected (0.03 sec)
 
mysql> select * from aaa where id = 1;
+----+-------+------+
| id | price | name |
+----+-------+------+
|  1 |    55 | test |
+----+-------+------+
1 row in set (0.03 sec)
 
mysql> 

```
此时price为55


#### 命令行二
```
mysql> begin;
Query OK, 0 rows affected (0.03 sec)
 
mysql> update aaa set price = 999 where id = 1;
Query OK, 1 row affected (0.03 sec)
Rows matched: 1  Changed: 1  Warnings: 0
 
mysql> 
```



#### 命令行一
```
mysql> select * from aaa where id = 1;
+----+-------+------+
| id | price | name |
+----+-------+------+
|  1 |   999 | test |
+----+-------+------+
1 row in set (0.03 sec)
 
mysql> 
```
可以看到这里的price已经变为999，但是我命令行二还没有提交。

### 命令行二
```
mysql> rollback;
Query OK, 0 rows affected (0.03 sec)
```
我数据已经回滚了

#### 命令行一
```
mysql> select * from aaa where id = 1;
+----+-------+------+
| id | price | name |
+----+-------+------+
|  1 |   999 | test |
+----+-------+------+
1 row in set (0.03 sec)
 
mysql> 

```
然后我命令行又执行了读取，发现价格还是999，如果我们这个事务用999来做业务处理，那肯定全部错了。

#### 命令行一
```
mysql> update aaa set price = (999 + 100) where id = 1;
Query OK, 1 row affected (0.04 sec)
Rows matched: 1  Changed: 1  Warnings: 0
 
mysql> select * from aaa where id = 1;
+----+-------+------+
| id | price | name |
+----+-------+------+
|  1 |  1099 | test |
+----+-------+------+
1 row in set (0.03 sec)
 
mysql> 
```


命令行一可以不执行begin也会有同样的结果。







### read commited











